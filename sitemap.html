<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Site Map</title>
  <link rel="stylesheet" href="sitemap-style.css" />
</head>
<body>
  <header>
    <h1><a href="index.html">Concept Wiki</a></h1>
    <nav>
      <ul class="nav-bar">
        <li><a href="systems.html">Systems</a></li>
        <li><a href="world-building.html">World Building</a></li>
        <li><a href="entities.html">Entities</a></li>
        <li><a href="sitemap.html">Sitemap</a></li>
      </ul>
    </nav>
    <h2>ðŸ“š Site Map</h2>
    <input type="text" id="searchBar" placeholder="Search pages..." onkeyup="filterPages()" />
  </header>

  <ul id="pageList"></ul>
  <noscript><p style="color:red">JavaScript is disabled or not working.</p></noscript>

  <script>
    console.log('Sitemap script loaded');
    let pagesData = [];

    async function loadPages() {
      try {
        const response = await fetch('./sitemap.json');
        if (!response.ok) {
          throw new Error('Network response was not ok: ' + response.status);
        }
        pagesData = await response.json();
        displayPages(pagesData);
      } catch (err) {
        document.getElementById('pageList').innerHTML = `<li style="color:red">Error loading sitemap: ${err.message}</li>`;
        console.error('Error loading sitemap:', err);
      }
    }

    function displayPages(pages) {
      const list = document.getElementById('pageList');
      list.innerHTML = '';
      pages.forEach(page => {
        const li = document.createElement('li');
        li.innerHTML = `<a href="${page.url}">${page.title}</a><span class="page-title">${page.description}</span>`;
        list.appendChild(li);
      });
    }

    function filterPages() {
      const query = document.getElementById('searchBar').value.toLowerCase();
      const filtered = pagesData.filter(page =>
        page.title.toLowerCase().includes(query) ||
        page.description.toLowerCase().includes(query)
      );
      displayPages(filtered);
    }

    loadPages();
  </script>
</body>
</html>
